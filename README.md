# Drone Topometric Localization System

Система топометричної локалізації дронів з графічним інтерфейсом на базі PyQt6.

## 🎯 Основні можливості

- **Desktop GUI (PyQt6)**: Професійний багатопотоковий інтерфейс для Windows.
- **Топометрична база даних**: Створення HDF5 бази з еталонних відео з автоматичною фільтрацією рухомих об'єктів.
- **Real-time локалізація**: Визначення GPS координат під час польоту.
- **Нейронні мережі**: YOLOv8-Seg (маскування), SuperPoint + NetVLAD (пошук), LightGlue (точний матчинг).
- **Мульти-якірне калібрування**: Інтерактивне прив'язування координат до кількох ключових кадрів.
- **Хвильова пропагація**: Автоматичне розповсюдження і блендінг GPS-координат на всі проміжні кадри бази за допомогою математичної матриці афінних перетворень.
- **Робота з панорамами**: Генерація панорам з еталонного відео та їх автоматичне геопросторове накладання на карту.
- **Інтерактивна карта**: Leaflet.js через QWebEngineView з відображенням маркера, траєкторії та полігону поля зору (FOV).
- **Kalman фільтрація та Z-test**: Згладжування траєкторій та відсіювання аномальних стрибків.

## 📋 Вимоги

### Апаратні вимоги
- NVIDIA GPU: RTX 3080 або краще (мінімум 8GB VRAM)
- CPU: 6+ ядер
- RAM: 16GB (рекомендовано 32GB)
- SSD: 50GB+ вільного місця

### Програмні вимоги
- Python 3.10 або 3.11
- CUDA 12.1+
- Windows 10/11 (основна платформа)

## 🚀 Швидкий старт

### 1. Встановлення

```powershell
# Клонування репозиторію
git clone <repository-url>
cd DroneLocalization

# Створення віртуального середовища
python -m venv .venv
.\.venv\Scripts\Activate.ps1

# Встановлення залежностей
pip install -r requirements.txt

# Встановлення hloc безпосередньо з GitHub (ОБОВ'ЯЗКОВО)
pip install git+[https://github.com/cvg/Hierarchical-Localization.git](https://github.com/cvg/Hierarchical-Localization.git)
```

### 2. Запуск програми

```powershell
# Запуск GUI
python main.py
```

## 📖 Workflow

### Етап 1: Створення бази даних

1. Запустити програму
2. Вибрати "Створити нову базу (Video -> HDF5)".
3. Завантажити еталонне відео
4. Встановити висоту польоту (для масштабування)
5. Почати обробку
6. Зачекати завершення (індикатор прогресу)

### Етап 2: GPS Калібрування

1. Відкрити створену базу даних
2. Вибрати меню "Калібрування" → "Додати якір...".
3. Знайти початковий кадр маршруту, клікнути на 3+ орієнтири у відео та ввести їхні реальні GPS-координати. Додати якір.
4. Повторити процедуру для кадру в середині маршруту та для фінального кадру.
5. Натиснути "Готово — запустити пропагацію". Програма автоматично розрахує координати для всіх тисяч проміжних кадрів за допомогою нейромережі LightGlue.

### Етап 3: Real-time локалізація

1. Підключити дрон або завантажити тестове відео польоту.
2. Завантажити калібровану базу даних (з уже виконаною пропагацією).
3. Натиснути "Почати відстеження".
4. Спостерігати точну локалізацію на карті в реальному часі зі згладжуванням траєкторії.

### Етап 4: Панорами (Опціонально)
1. Натиснути "Згенерувати панораму з відео", щоб створити широке зображення місцевості.
2. Натиснути "Накласти панораму на карту". Система розріже панораму, знайде її координати через нейромережі та відобразить поверх супутникової карти.

## 🏗️ Архітектура

```
src/
├── gui/              # PyQt6 графічний інтерфейс
├── workers/          # QThread фонові потоки (трекінг, БД, панорами)
├── models/           # Обгортки для нейромереж (YOLO, SuperPoint, NetVLAD, LightGlue)
├── database/         # Генерація та читання HDF5
├── localization/     # Пайплайн розпізнавання
├── geometry/         # Геометричні трансформації (афінні, гомографія)
├── calibration/      # Мульти-якірне калібрування та хвильова пропагація
├── tracking/         # Kalman фільтр та Outlier детекція (Z-test)
└── utils/            # Допоміжні функції та логування
```

## 🔧 Розробка

### Запуск тестів

```powershell
pytest tests/ -v
```

### Компіляція у .exe

```powershell
# PyInstaller
python scripts/build_executable.py
```


## 📧 Контакти

Для питань та підтримки відкрийте Issue на GitHub.
