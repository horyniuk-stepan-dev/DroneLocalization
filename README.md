# Drone Topometric Localization System

Професійна система топометричної локалізації та візуальної навігації дронів у середовищах без стабільного сигналу GPS. Завдяки використанню сучасних Foundation Models (базових моделей) та семантичного аналізу, система забезпечує високоточне визначення координат, стійке до жорстких змін освітлення, тіней, погодних умов та пори року.

## 🎯 Основні можливості

- **Desktop GUI (PyQt6)**: Багатопотоковий графічний інтерфейс для Windows, оптимізований для роботи в реальному часі.
- **Семантична глобальна локалізація (DINOv2)**: Використання трансформерної моделі від Meta для розуміння фізичної суті та геометрії об'єктів. Дозволяє системі розпізнавати місцевість незалежно від того, чи вона освітлена сонцем, чи знаходиться в тіні.
- **Фільтрація динамічних об'єктів (YOLOv8-Seg)**: Автоматичне нейромережеве маскування автомобілів, людей та інших рухомих об'єктів під час створення еталонної бази, що гарантує прив'язку лише до стабільної геометрії (доріг, будівель).
- **Адаптивний препроцесинг (CLAHE)**: Алгоритм локального вирівнювання контрасту, який "витягує" текстури та кути навіть із найглибших тіней для надійного локального розпізнавання.
- **Точний матчинг ознак**: Комплекс SuperPoint (витягування ключових точок) та LightGlue (швидкий та стійкий пошук збігів).
- **Мульти-якірне калібрування та Хвильова пропагація**: Інтерактивне задання GPS-координат для кількох ключових кадрів із подальшим автоматичним математичним розповсюдженням (афінні перетворення) на всі тисячі проміжних кадрів у базі.
- **Надійна фільтрація траєкторії**: Вбудований фільтр Калмана (Kalman Filter) для згладжування маршруту та статистичний детектор аномалій (Z-score + Speed limit) для відсіювання хибних стрибків локалізації.
- **Інтерактивна карта та Панорами**: Відображення дрона, його траєкторії та поля зору (FOV) на карті Leaflet. Генерація панорам із відео та їх автоматичне геопросторове накладання на супутникову карту.

## 📋 Вимоги до системи

### Апаратні вимоги
- **GPU**: NVIDIA з підтримкою CUDA (мінімум **4GB VRAM**, наприклад, GTX 1650 або краще)
- **CPU**: 6+ ядер
- **RAM**: 16 GB (рекомендовано 32 GB для великих баз даних)
- **Накопичувач**: SSD (рекомендовано, бази даних HDF5 займають мінімум місця завдяки розмірності дескрипторів 384)

### Програмні вимоги
- Python 3.11
- PyTorch 2.2.0 (CUDA 12.1)
- Windows 10/11 (основна платформа)
## 🚀 Швидкий старт

### 1. Встановлення

```powershell
# Клонування репозиторію
git clone <repository-url>
cd DroneLocalization

# Створення віртуального середовища
python -m venv .venv
.\.venv\Scripts\Activate.ps1

# Встановлення залежностей
pip install -r requirements.txt

# Встановлення hloc безпосередньо з GitHub (ОБОВ'ЯЗКОВО)
pip install git+https://github.com/cvg/Hierarchical-Localization.git
```

### 2. Запуск програми

```powershell
# Запуск GUI
python main.py
```

## 📖 Workflow

### Етап 1: Створення бази даних

1. Запустити програму
2. У програмі виберіть "Створити нову місію".
3. Завантажити еталонне відео
4. Встановити висоту польоту (для масштабування)
5. Почати обробку
6. Зачекати завершення (індикатор прогресу)

### Етап 2: GPS Калібрування

1. Відкрити створену базу даних
2. Вибрати меню "Калібрування" → "Додати якір...".
3. Знайти початковий кадр маршруту, клікнути на 3+ орієнтири у відео та ввести їхні реальні GPS-координати. Додати якір.
4. Повторити процедуру для кадру в середині маршруту та для фінального кадру.
5. Натиснути "Готово — запустити пропагацію". Програма автоматично розрахує координати для всіх тисяч проміжних кадрів за допомогою нейромережі LightGlue.

### Етап 3: Real-time локалізація

1. Підключити дрон або завантажити тестове відео польоту.
2. Завантажити калібровану базу даних (з уже виконаною пропагацією).
3. Натиснути "Почати відстеження".
4. Спостерігати точну локалізацію на карті в реальному часі зі згладжуванням траєкторії.

### Етап 4: Панорами (Опціонально)
1. Натиснути "Згенерувати панораму з відео", щоб створити широке зображення місцевості.
2. Натиснути "Накласти панораму на карту". Система розріже панораму, знайде її координати через нейромережі та відобразить поверх супутникової карти.

## 🏗️ Архітектура

```
src/
├── gui/              # PyQt6 графічний інтерфейс
├── workers/          # QThread фонові потоки (трекінг, БД, панорами)
├── models/           # Обгортки для нейромереж (YOLO, SuperPoint, NetVLAD, LightGlue)
├── database/         # Генерація та читання HDF5
├── localization/     # Пайплайн розпізнавання
├── geometry/         # Геометричні трансформації (афінні, гомографія)
├── calibration/      # Мульти-якірне калібрування та хвильова пропагація
├── tracking/         # Kalman фільтр та Outlier детекція (Z-test)
└── utils/            # Допоміжні функції та логування
```

## 🔧 Розробка

### Запуск тестів

```powershell
pytest tests/ -v
```

### Компіляція у .exe

```powershell
# PyInstaller
python scripts/build_executable.py
```


## 📧 Контакти

Для питань та підтримки відкрийте Issue на GitHub.
